{% extends 'layout.html' %}

{% block content %}


<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>

<script src="http://localhost:3300/socket.io/socket.io.js"></script>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<style type="text/css">
  .google-visualization-table-td {
    text-align: center;}
</style>

<div class= container>
<h2> Broker Mqtt</h2>
<div id="container" style="min-width: 310px; max-width: 400px; height: 300px; margin: 0 auto"></div>
</br>
<div id="table_div"> </div>

</div>
<script>
var chart = Highcharts.chart('container', {

    chart: {
        type: 'gauge',
        plotBackgroundColor: null,
        plotBackgroundImage: null,
        plotBorderWidth: 0,
        plotShadow: false
    },

    title: {
        text: 'Termometro'
    },

    pane: {
        startAngle: -150,
        endAngle: 150,
        background: [{
            backgroundColor: {
                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                stops: [
                    [0, '#FFF'],
                    [1, '#333']
                ]
            },
            borderWidth: 0,
            outerRadius: '109%'
        }, {
            backgroundColor: {
                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                stops: [
                    [0, '#333'],
                    [1, '#FFF']
                ]
            },
            borderWidth: 1,
            outerRadius: '107%'
        }, {
            // default background
        }, {
            backgroundColor: '#DDD',
            borderWidth: 0,
            outerRadius: '105%',
            innerRadius: '103%'
        }]
    },

    // the value axis
    yAxis: {
        min: 0,
        max: 200,

        minorTickInterval: 'auto',
        minorTickWidth: 1,
        minorTickLength: 10,
        minorTickPosition: 'inside',
        minorTickColor: '#666',

        tickPixelInterval: 30,
        tickWidth: 2,
        tickPosition: 'inside',
        tickLength: 10,
        tickColor: '#666',
        labels: {
            step: 2,
            rotation: 'auto'
        },
        title: {
            text: 'C°'
        },
        plotBands: [{
            from: 0,
            to: 120,
            color: '#55BF3B' // green
        }, {
            from: 120,
            to: 160,
            color: '#DDDF0D' // yellow
        }, {
            from: 160,
            to: 200,
            color: '#DF5353' // red
        }]
    },

    series: [{
        name: 'temperatura',
        data: [0],
        tooltip: {
            valueSuffix: ' C°'
        }
    }]

},
// Add some life
/*function (chart) {
    if (!chart.renderer.forExport) {
        setInterval(function () {
            var point = chart.series[0].points[0],
                newVal,
                inc = Math.round((Math.random() - 0.5) * 20);

            newVal = point.y + inc;
            if (newVal < 0 || newVal > 200) {
                newVal = point.y - inc;
            }

            point.update(newVal);

        }, 3000);
    }
}*/);
  var socket = io.connect('http://localhost:3300', { 'forceNew': true });
  google.charts.load('current', {'packages':['table']});
   google.charts.setOnLoadCallback(drawTable);
   var aux;
   var tab;
   
   socket.on('notification', setData);
   
   
   function drawTable(){
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Topico');
    data.addColumn('string', 'Mensaje');
    aux = data;

    var table = new google.visualization.Table(document.getElementById('table_div'));
    tab = table;
    table.draw(data, {showRowNumber: true, width: '100%', height: '100%', alternatingRowStyle: true});}

   function setData(msj){
    //console.log(msj);
    var data = msj.split("-");
    aux.addRows([
     [data[1], data[0]]
    ]);
    tab.draw(aux, {showRowNumber: true, width: '100%', height: '100%'});
    if (data[1] == "aerogenerador/clima"){
      var temperatura = parseInt(data[0]);
    }
    var point = chart.series[0].points[0];
    point.update(temperatura);
   }
</script>

{% endblock %}